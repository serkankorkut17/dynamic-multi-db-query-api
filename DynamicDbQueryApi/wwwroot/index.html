<!doctype html>
<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Dynamic Query Console</title>
    <style>
      :root { color-scheme: light dark; font-family: system-ui, Arial, sans-serif; }
      body { margin: 1.25rem; line-height: 1.4; }
      h1 { margin-top: 0; }
      fieldset { border: 1px solid #777; padding: .75rem 1rem 1rem; margin-bottom: 1.25rem; }
      legend { font-weight: 600; padding: 0 .5rem; }
      label { display:block; font-size:.8rem; font-weight:600; text-transform:uppercase; letter-spacing:.05em; margin-top:.75rem; }
      input[type=text], textarea, select { width:100%; box-sizing:border-box; font:inherit; padding:.5rem; border:1px solid #666; border-radius:4px; background:var(--bg,inherit); }
      textarea { min-height:90px; resize:vertical; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
      .row { display:flex; flex-wrap:wrap; gap:1.25rem; }
      .col { flex:1 1 420px; min-width:320px; }
      button { cursor:pointer; padding:.55rem .95rem; font:inherit; border:1px solid #555; border-radius:4px; background:#1e6bd6; color:#fff; font-weight:600; display:inline-flex; align-items:center; gap:.4rem; }
      button.secondary { background:#555; }
      button:disabled { opacity:.55; cursor:progress; }
      pre { background:#1115; padding:.75rem 1rem; border-radius:6px; overflow:auto; max-height:340px; font-size:.78rem; }
      .outputs { display:flex; flex-wrap:wrap; gap:1.25rem; }
      .panel { flex:1 1 460px; min-width:320px; }
      .bad { color:#d33; font-weight:600; }
      .toolbar { display:flex; gap:.5rem; margin-top:.6rem; }
      small.hint { opacity:.75; font-weight:400; font-size:.65rem; display:block; margin-top:.2rem; }
      .badge { background:#444; color:#fff; padding:.15rem .45rem; border-radius:999px; font-size:.65rem; font-weight:600; letter-spacing:.05em; }
      .flex-end { display:flex; justify-content:flex-end; gap:.5rem; }
      hr { margin:2rem 0; border:none; border-top:1px solid #444; }
      .mode-selector { display:flex; gap:.5rem; margin-bottom:1rem; }
      .mode-btn { padding:.4rem .8rem; border:1px solid #666; background:#333; color:#fff; cursor:pointer; border-radius:4px; }
      .mode-btn.active { background:#1e6bd6; border-color:#1e6bd6; }
      .query-section { display:none; }
      .query-section.active { display:block; }
      .collapsible { cursor:pointer; user-select:none; }
      .collapsible:hover { background:#f5f5f5; }
      .collapsible-content { display:none; }
      .collapsible-content.open { display:block; }
      .checkbox-field { display:flex; align-items:center; gap:.5rem; margin:.5rem 0; }
      .checkbox-field input[type="checkbox"] { width:auto; }
      .data-table { width:100%; border-collapse:collapse; font-size:.8rem; margin-top:.5rem; }
      .data-table th, .data-table td { border:1px solid #666; padding:.3rem .5rem; text-align:left; }
      .data-table th { background:#333; color:#fff; font-weight:600; }
      .data-table tbody tr:nth-child(even) { background:#1115; }
      .status-badge { padding:.2rem .4rem; border-radius:3px; font-size:.7rem; font-weight:600; }
      .status-success { background:#4CAF50; color:white; }
      .status-info { background:#2196F3; color:white; }
    </style>
  </head>
  <body>
    <h1>Dynamic Query Console</h1>
    <p>Veritabanı sorgularını çalıştırın, sonuçları karşılaştırın ve başka bir veritabanına kaydedin.</p>

    <form id="shared" onsubmit="return false;">
      <fieldset>
        <legend>Input Database</legend>
        <div class="row">
          <div class="col">
            <label for="dbType">DB Type</label>
            <select id="dbType">
              <option value="postgres">PostgreSQL</option>
              <option value="mysql">MySQL</option>
              <option value="mssql">SQL Server</option>
              <option value="oracle">Oracle</option>
            </select>
          </div>
        </div>
        <label for="conn">Connection String</label>
        <textarea id="conn" placeholder="Host=localhost;Port=5432;Database=querydb;Username=postgres;Password=postgres"></textarea>
        <div class="toolbar">
          <button type="button" id="inspectBtn">Database Yapısını İncele</button>
        </div>
      </fieldset>
    </form>

    <fieldset id="inspectSection" style="display:none;">
      <legend>Database Yapısı</legend>
      <div id="inspectResult">(henüz incelenmedi)</div>
    </fieldset>

    <fieldset>
      <legend>Query Mode</legend>
      <div class="mode-selector">
        <button type="button" class="mode-btn active" data-mode="dsl">DSL Query</button>
        <button type="button" class="mode-btn" data-mode="sql">Raw SQL</button>
      </div>
      
      <div class="query-section active" id="dslSection">
        <label for="dsl">Custom DSL Sorgu</label>
        <textarea id="dsl" placeholder="FETCH(id, name) FILTER(age > 18 AND status = 'A') FROM(users) INCLUDE(orders)"></textarea>
        <small class="hint">Örnekler: FETCH(id, name) FROM users | FILTER(age > 18) | INCLUDE(orders INNER) | GROUPBY(status) HAVING(COUNT(*) > 5)</small>
      </div>
      
      <div class="query-section" id="sqlSection">
        <label for="sql">Raw SQL Sorgu</label>
        <textarea id="sql" placeholder="SELECT id, name FROM users LEFT JOIN orders ON users.id = orders.user_id WHERE age > 18 AND status = 'A';"></textarea>
        <small class="hint">Ham SQL sorgunuzu yazın. Çoklu statement desteklenmez.</small>
      </div>

      <div class="checkbox-field">
        <input type="checkbox" id="writeToOutput">
        <label for="writeToOutput">Sonuçları başka bir veritabanına kaydet</label>
      </div>

      <div id="outputDbSection" style="display:none;">
        <fieldset>
          <legend>Output Database</legend>
          <div class="row">
            <div class="col">
              <label for="outputDbType">Output DB Type</label>
              <select id="outputDbType">
                <option value="postgres">PostgreSQL</option>
                <option value="mysql">MySQL</option>
                <option value="mssql">SQL Server</option>
                <option value="oracle">Oracle</option>
              </select>
            </div>
            <div class="col">
              <label for="outputTableName">Table Name</label>
              <input type="text" id="outputTableName" placeholder="result_table">
            </div>
          </div>
          <label for="outputConn">Output Connection String</label>
          <textarea id="outputConn" placeholder="Output database connection string"></textarea>
        </fieldset>
      </div>

      <div class="toolbar flex-end">
        <button type="button" id="runQuery">Sorguyu Çalıştır</button>
        <button type="button" class="secondary" id="clearQuery">Temizle</button>
      </div>
    </fieldset>

    <hr />
    <fieldset>
      <legend>Query Sonuçları</legend>
      <div id="queryStatus"></div>
      <div id="queryResult">(henüz sorgu çalıştırılmadı)</div>
    </fieldset>

    <hr />
    <fieldset>
      <legend class="collapsible" id="compareToggle">Karşılaştırma Aracı ▼</legend>
      <div class="collapsible-content" id="compareContent">
        <p>İki farklı sorgu sonucunu karşılaştırmak için bu bölümü kullanabilirsiniz.</p>
        <div class="row">
          <div class="col">
            <fieldset>
              <legend>DSL Query</legend>
              <textarea id="compareDsl" placeholder="FETCH(id, name) FROM users"></textarea>
              <div class="toolbar flex-end">
                <button type="button" id="runCompareDsl">Çalıştır</button>
                <button type="button" class="secondary" id="clearDsl">Temizle</button>
              </div>
              <pre id="outDsl">(sonuç yok)</pre>
            </fieldset>
          </div>
          <div class="col">
            <fieldset>
              <legend>SQL Query</legend>
              <textarea id="compareSql" placeholder="SELECT id, name FROM users"></textarea>
              <div class="toolbar flex-end">
                <button type="button" id="runCompareSql">Çalıştır</button>
                <button type="button" class="secondary" id="clearSql">Temizle</button>
              </div>
              <pre id="outSql">(sonuç yok)</pre>
            </fieldset>
          </div>
        </div>
        <div class="toolbar">
          <button type="button" id="compareBtn">Sonuçları Karşılaştır</button>
          <button type="button" class="secondary" id="clearCompare">Temizle</button>
        </div>
        <pre id="outCompare">(karşılaştırma sonucu)</pre>
      </div>
    </fieldset>
    <script src="app.js"></script>
  </body>
</html>
